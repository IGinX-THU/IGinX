name: tests

on:
    pull_request: # when a PR is opened or reopened
        types: [opened, reopened]
        branches:
            - main

concurrency:
    group: "${{ github.workflow }}-${{ github.ref }}"
    cancel-in-progress: true

jobs:
    standalone-test-no-mac-relational:
        uses: ./.github/workflows/standalone-test.yml
        with:
            metadata-matrix: '["zookeeper"]'
            os-matrix: '["windows-latest"]'
            db-matrix: '["Dameng", "Oracle"]'
            timeout-minutes: 100
    standalone-test-no-mac-no-privs-relational:
        uses: ./.github/workflows/standalone-test.yml
        with:
            metadata-matrix: '["zookeeper"]'
            os-matrix: '["ubuntu-latest", "windows-latest"]'
            db-matrix: '["Dameng"]'
            db-support-create-database: false
            timeout-minutes: 120
    db-ce-no-mac-relational:
        uses: ./.github/workflows/DB-CE.yml
        with:
            metadata-matrix: '["zookeeper"]'
            os-matrix: '["windows-latest"]'
            db-matrix: '["Dameng", "Oracle"]'
            functest: "UDFIT#windowsRelationalTest"
            timeout-minutes: 120
    standalone-test-vectordb:
        uses: ./.github/workflows/standalone-test.yml
        with:
            metadata-matrix: '["zookeeper"]'
            os-matrix: '["windows-latest"]'
            db-matrix: '["VectorDB"]'
            timeout-minutes: 300
    db-ce-vectordb:
        uses: ./.github/workflows/DB-CE.yml
        with:
            metadata-matrix: '["zookeeper"]'
            os-matrix: '["windows-latest"]'
            db-matrix: '["VectorDB"]'
            functest: "UDFIT#windowsRelationalTest"
            timeout-minutes: 360
    db-ce-no-optimizer-vectordb:
        uses: ./.github/workflows/DB-CE.yml
        with:
            metadata-matrix: '["zookeeper"]'
            os-matrix: '["windows-latest"]'
            db-matrix: '["VectorDB"]'
            functest: "UDFIT#windowsRelationalTest"
            timeout-minutes: 360
            close-optimizer: "true"